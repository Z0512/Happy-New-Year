<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
<title>新年快乐 </title>
<style>
html,body{
  margin:0;
  padding:0;
  background:radial-gradient(ellipse at bottom,#050505 0%,#000 70%);
  overflow:hidden;
}
canvas{position:fixed;inset:0}
.title{
  position:fixed;
  top:16%;
  width:100%;
  text-align:center;
  font-size:44px;
  color:#fff;
  text-shadow:
    0 0 10px #fff,
    0 0 30px #ffcc00,
    0 0 60px #ff3300;
  z-index:2;
}
.tip{
  position:fixed;
  bottom:10%;
  width:100%;
  text-align:center;
  color:#aaa;
  font-size:14px;
}
</style>
</head>

<body>
<canvas id="c"></canvas>
<div class="title"> 新年快乐 </div>
<div class="tip">点击屏幕放烟花</div>

<script>
const c = document.getElementById("c");
const ctx = c.getContext("2d");
resize(); window.onresize=resize;
function resize(){c.width=innerWidth;c.height=innerHeight;}

const GRAVITY = 0.028;       // ↓ 重力减小
let rockets=[], particles=[], sparks=[];

class Rocket{
  constructor(x){
    this.x = x;
    this.y = c.height;
    this.vy = -Math.random()*2.5 - 6; // ↓ 升空变慢
    this.trail = [];
    this.exploded = false;
    this.targetY = c.height*(0.32 + Math.random()*0.36);
    this.wait = 18; //  爆前停留帧数
  }
  update(){
    this.trail.push({x:this.x,y:this.y});
    if(this.trail.length>14) this.trail.shift();

    if(this.y > this.targetY){
      this.y += this.vy;
      this.vy += GRAVITY * 0.15;
    }else{
      if(this.wait-- <= 0) this.explode();
    }
  }
  explode(){
    this.exploded = true;
    flash(this.x,this.y);
    burst(this.x,this.y);
  }
  draw(){
    ctx.strokeStyle="rgba(255,190,120,0.75)";
    ctx.lineWidth=2;
    ctx.beginPath();
    this.trail.forEach((p,i)=>{
      i?ctx.lineTo(p.x,p.y):ctx.moveTo(p.x,p.y);
    });
    ctx.stroke();
  }
}

class Particle{
  constructor(x,y,angle,speed,color){
    this.x=x; this.y=y;
    this.vx=Math.cos(angle)*speed;
    this.vy=Math.sin(angle)*speed;
    this.life=1;
    this.color=color;
  }
  update(){
    this.x+=this.vx;
    this.y+=this.vy;
    this.vy+=GRAVITY;
    this.life-=0.008; // ↓ 衰减更慢
  }
  draw(){
    if(this.life<=0) return;
    ctx.save();
    ctx.globalAlpha=this.life;
    ctx.strokeStyle=this.color;
    ctx.lineWidth=2;
    ctx.shadowBlur=22;
    ctx.shadowColor=this.color;
    ctx.beginPath();
    ctx.moveTo(this.x,this.y);
    ctx.lineTo(this.x-this.vx*0.9,this.y-this.vy*0.9);
    ctx.stroke();
    ctx.restore();
  }
}

class Spark{
  constructor(x,y){
    const a=Math.random()*Math.PI*2;
    this.x=x; this.y=y;
    this.vx=Math.cos(a)*(Math.random()*1.1);
    this.vy=Math.sin(a)*(Math.random()*1.1);
    this.life=1;
  }
  update(){
    this.x+=this.vx;
    this.y+=this.vy;
    this.life-=0.035;
  }
  draw(){
    ctx.fillStyle=`rgba(255,255,255,${this.life})`;
    ctx.fillRect(this.x,this.y,2,2);
  }
}

function flash(x,y){
  ctx.save();
  ctx.globalAlpha=0.65;
  ctx.fillStyle="#fff";
  ctx.beginPath();
  ctx.arc(x,y,90,0,Math.PI*2);
  ctx.fill();
  ctx.restore();
}

function burst(x,y){
  const hue=Math.random()*360;
  const color=`hsl(${hue},100%,65%)`;

  for(let i=0;i<160;i++){
    const a=Math.random()*Math.PI*2;
    const s=Math.random()*3.8+1.8; // ↓ 爆炸扩散变慢
    particles.push(new Particle(x,y,a,s,color));
  }
  for(let i=0;i<50;i++) sparks.push(new Spark(x,y));
}

function loop(){
  ctx.fillStyle="rgba(0,0,0,0.16)";
  ctx.fillRect(0,0,c.width,c.height);

  rockets.forEach((r,i)=>{
    r.update(); r.draw();
    if(r.exploded) rockets.splice(i,1);
  });

  particles.forEach((p,i)=>{
    p.update(); p.draw();
    if(p.life<=0) particles.splice(i,1);
  });

  sparks.forEach((s,i)=>{
    s.update(); s.draw();
    if(s.life<=0) sparks.splice(i,1);
  });

  requestAnimationFrame(loop);
}

function launch(x){rockets.push(new Rocket(x));}
c.onclick=e=>launch(e.clientX);
c.ontouchstart=e=>launch(e.touches[0].clientX);
setInterval(()=>launch(Math.random()*c.width),1600);

loop();
</script>
</body>
</html>
